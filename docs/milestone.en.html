<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Ray Marching Collision Detection for Cloth Simulation - Milestone Report
    </title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f9f9f9;
      }
      header {
        text-align: center;
        padding: 20px 0;
        border-bottom: 2px solid #3498db;
        margin-bottom: 30px;
      }
      h1 {
        color: #2c3e50;
        margin-bottom: 10px;
      }
      h2 {
        color: #3498db;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
        margin-top: 30px;
      }
      .content-section {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .image-container {
        text-align: center;
        margin: 20px 0;
      }
      img {
        max-width: 100%;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .code-block {
        background-color: #f5f5f5;
        border-left: 4px solid #3498db;
        padding: 15px;
        margin: 20px 0;
        overflow-x: auto;
        font-family: "Courier New", monospace;
      }
      .highlight {
        background-color: #fffde7;
        padding: 2px 5px;
        border-radius: 3px;
      }
      footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        color: #7f8c8d;
        font-size: 0.9em;
      }
      .team-members {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        margin: 20px 0;
      }
      .team-member {
        text-align: center;
        width: 150px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Ray Marching Collision Detection for Cloth Simulation</h1>
      <p>Project Milestone Report</p>
    </header>

    <div class="content-section">
      <h2>Project Overview</h2>
      <p>
        Our project aims to use Ray Marching technology to replace traditional
        triangle-based distance collision detection methods. When cloth
        interacts with collision objects (such as spheres), we use Ray Marching
        through VDB (Voxel Distance Field) or SDF (Signed Distance Field) to
        detect collisions, rather than relying on mesh geometry. This approach
        requires consideration of camera movement effects on ray directions and
        implementation of acceleration structures to improve performance.
        Compared to traditional HW4 methods, Ray Marching will show differences
        in FPS performance.
      </p>
      <div class="team-members">
        <div class="team-member">
          <p>member 1</p>
        </div>
        <div class="team-member">
          <p>member 2</p>
        </div>
        <div class="team-member">
          <p>member 3</p>
        </div>
        <div class="team-member">
          <p>member 4</p>
        </div>
      </div>
    </div>

    <div class="content-section">
      <h2>Completed Work</h2>
      <ul>
        <li>
          <strong>Ray Marching Shader Implementation:</strong>
          Completed a volume rendering shader based on ray marching that can
          handle dynamic camera perspective changes.
        </li>
        <li>
          <strong>HW4 Platform Integration:</strong>
          Successfully integrated the Ray Marching shader into the HW4 cloth
          simulation platform, achieving basic volume rendering effects.
        </li>
        <li>
          <strong>Dynamic Perspective Support:</strong>
          Implemented support for camera movement, allowing observation of
          different lighting effects when rotating the view.
        </li>
        <li>
          <strong>Cloth Particle Texture System:</strong>
          Established an efficient texture system that transmits cloth particle
          positions to the shader in real-time.
        </li>
        <li>
          <strong>Volume Rendering Foundation:</strong>
          Implemented basic volume rendering equations, laying the groundwork
          for subsequent collision detection.
        </li>
      </ul>

      <div class="code-block">
        <pre>
// Core part of the current Ray Marching shader implementation
void main() {
    // Convert UV coordinates to correct ray direction (considering camera movement)
    vec2 ndc = v_uv * 2.0 - 1.0;
    vec4 clip = vec4(ndc, -1.0, 1.0);
    vec4 world = u_inv_view_projection * clip;
    world /= world.w;
    vec3 ray_direction = normalize(world.xyz - u_cam_pos);
    
    // Ray marching loop
    vec3 ray_origin = u_cam_pos;
    vec3 color = vec3(0.0);
    float transmittance = 1.0;
    
    for (int i = 0; i < MAX_STEPS; i++) {
        vec3 sample_pos = ray_origin + ray_direction * (i * STEP_SIZE);
        
        // Calculate density field (preparing for subsequent collision detection)
        float density = calculateDensity(sample_pos);
        
        if (density > 0.05) {
            // Volume rendering calculation
            vec3 light_dir = normalize(u_light_pos - sample_pos);
            float diffuse = max(0.0, dot(normalize(vec3(0, 1, 0)), light_dir));
            vec3 sample_color = vec3(0.2, 0.6, 0.9) * (0.3 + 0.7 * diffuse) * density;
            
            color += sample_color * transmittance * STEP_SIZE;
            transmittance *= (1.0 - density * 0.15);
        }
    }
    
    out_color = vec4(mix(background, color, 1.0 - transmittance), 1.0);
}</pre
        >
      </div>
    </div>

    <div class="content-section">
      <h2>Initial Results</h2>
      <p>
        We have successfully implemented the basic framework for Ray Marching,
        with current achievements including:
      </p>
      <ul>
        <li>
          Ray Marching shader correctly responds to camera perspective changes
        </li>
        <li>Successfully integrated into the HW4 cloth simulation platform</li>
        <li>Achieved basic volume rendering effects</li>
        <li>Can observe dynamic lighting changes when rotating the view</li>
        <li>
          Established data transmission mechanism for cloth particle positions
        </li>
      </ul>

      <!-- <div class="image-container">
        <p><em>Screenshots will be added in the final report</em></p>
      </div> -->
    </div>

    <div class="content-section">
      <h2>Progress Reflection</h2>
      <p>
        Our project has made good progress in the basic implementation of Ray
        Marching technology. The current phase focuses on establishing technical
        foundations and preparing for subsequent collision detection
        functionality. Main challenges include:
      </p>
      <ul>
        <li>
          <strong>Camera Movement Handling:</strong>
          Ensuring Ray Marching can correctly handle dynamic camera
          perspectives, with ray direction calculations considering camera
          position changes.
        </li>
        <li>
          <strong>Performance Optimization:</strong>
          Ray Marching calculations are computationally expensive, requiring
          optimization strategies for subsequent collision detection.
        </li>
        <li>
          <strong>Platform Integration:</strong>
          Successfully integrating Ray Marching technology into the existing HW4
          cloth simulation framework.
        </li>
        <li>
          <strong>Data Flow Management:</strong>
          Establishing efficient data transmission mechanisms for cloth particle
          positions.
        </li>
      </ul>
      <p>
        Current progress has laid a solid foundation for subsequent
        implementation of Ray Marching-based collision detection.
      </p>
    </div>

    <div class="content-section">
      <h2>Updated Work Plan</h2>
      <p>
        For the core goal implementation of the project, we plan to focus on the
        following areas:
      </p>
      <ol>
        <li>
          <strong>SDF/VDB Implementation:</strong>
          Implement Signed Distance Fields (SDF) or Voxel Distance Fields (VDB)
          to represent collision object volumes.
        </li>
        <li>
          <strong>Collision Detection Algorithm:</strong>
          Implement Ray Marching-based collision detection between cloth and
          objects like spheres, replacing traditional triangle distance
          detection.
        </li>
        <li>
          <strong>Acceleration Structures:</strong>
          Implement spatial acceleration structures (such as octrees, BVH, etc.)
          to improve Ray Marching collision detection performance.
        </li>
        <li>
          <strong>Performance Comparison Analysis:</strong>
          Compare FPS performance differences between Ray Marching methods and
          traditional HW4 methods.
        </li>
        <li>
          <strong>Dynamic Object Support:</strong>
          Extend the system to support dynamically moving collision objects.
        </li>
      </ol>
    </div>

    <div class="content-section">
      <h2>Technical Details</h2>
      <h3>Current Ray Marching Implementation</h3>
      <p>
        Our current Ray Marching implementation lays the foundation for
        subsequent collision detection:
      </p>
      <ul>
        <li>
          <strong>Dynamic Ray Direction:</strong>
          Use inverse view-projection matrix to calculate correct ray
          directions, supporting camera movement.
        </li>
        <li>
          <strong>Density Field Calculation:</strong>
          Calculate 3D density fields based on cloth particle positions,
          providing foundation for collision detection.
        </li>
        <li>
          <strong>Volume Rendering:</strong>
          Implement basic volume rendering equations, demonstrating Ray Marching
          visual effects.
        </li>
        <li>
          <strong>Performance Optimization:</strong>
          Implement early exit mechanisms, preparing for performance
          optimization of subsequent collision detection.
        </li>
      </ul>

      <h3>Density Field Calculation</h3>
      <p>
        Current density field calculation provides foundation for subsequent SDF
        collision detection:
      </p>
      <div class="code-block">
        <pre>
float calculateDensity(vec3 pos) {
    float density = 0.0;
    int samples = 0;
    
    // Sample cloth particle positions
    for (int i = 0; i < u_cloth_tex_width && samples < 16; i += 3) {
        for (int j = 0; j < u_cloth_tex_height && samples < 16; j += 3) {
            samples++;
            
            // Get particle position from texture
            float u = (float(i) + 0.5) / float(u_cloth_tex_width);
            float v = (float(j) + 0.5) / float(u_cloth_tex_height);
            vec3 particle_pos = texture(u_cloth_particles_tex, vec2(u, v)).xyz;
            
            // Calculate distance and density contribution
            float dist = length(pos - particle_pos);
            if (dist < 1.2) {
                float falloff = 1.0 - dist / 1.2;
                density += falloff * 0.4;
                
                if (density > 0.8) break;
            }
        }
        if (density > 0.8) break;
    }
    
    return min(density, 1.0);
}</pre
        >
      </div>

      <h3>HW4 Platform Integration</h3>
      <p>Integration with HW4 cloth simulation:</p>
      <ul>
        <li>
          <strong>Texture System:</strong>
          Store cloth particle positions in 2D textures, updated every frame.
        </li>
        <li>
          <strong>Shader Integration:</strong>
          Integrate Ray Marching shader into existing rendering pipeline.
        </li>
        <li>
          <strong>Camera Support:</strong>
          Correctly handle dynamic camera perspective effects on Ray Marching.
        </li>
        <li>
          <strong>Performance Monitoring:</strong>
          Establish foundation for subsequent performance comparison analysis.
        </li>
      </ul>
    </div>
  </body>
</html>
